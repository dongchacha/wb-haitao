define(["angular","util","iscroll"],function(a,b,c){"use strict";b.getStyle(GConfig.LIB_ADDRESS+"iscroll/scrollbar.css");var d='<div id="pullDown" class="flip loading"><span class="pullDownIcon"></span><span class="pullDownLabel">加载中...</span></div>',e='<div id="pullUp" class="loading"><span class="pullUpIcon"></span><span class="pullUpLabel"></span></div>',f={targetNode:null,upCallBack:null,downCallBack:null},g=a.module("ng.myScroll",[]);g.directive("myScroll",[function(){return{restrict:"C",replace:!1,transclude:!0,scope:{config:"=",ready:"="},link:function(a,b,g,h){var i,j;j=!1,new(i=function(){function h(){this.bindRender(),this.initScroll()}return h.prototype.initScroll=function(){document.addEventListener("touchmove",function(a){a.preventDefault()},!1);var h,i,j=$.extend({},f,a.config),k=this,l=g.id?g.id:"myScroll"+(Date.now()+Math.round(1e3*Math.random())),m=$(b).attr("id",l),n=m.find(">div:first"),o=45;k.upCallBack=j.upCallBack,k.downCallBack=j.downCallBack,h=$(d).prependTo(n),k.upCallBack&&(i=$(e).appendTo(n)),k._myScroll=new c(m.get(0),{useTransition:!0,topOffset:o,onRefresh:function(){alert("refresh"),h.is(".loading")?h.removeClass("flip").removeClass("loading").find(".text").html("下拉刷新"):i&&i.removeClass("flip").removeClass("loading").find("img").css("opacity",0)},onScrollMove:function(){k.isLoading||(this.y>5&&!h.is(".flip")&&(h.addClass("flip").find(".text").html("释放刷新"),this.minScrollY=0),i&&!k._isLoadMoreEnd&&this.y<0&&(i.find("img").css("opacity",1),this.y<this.maxScrollY-5&&!i.is(".flip")&&i.addClass("flip").find("text").html("释放刷新")))},onScrollEnd:function(){k.isLoading||(h.is(".flip")&&(k.isLoading=!0,h.addClass("loading").find(".text").html("加载中"),k.downCallBack&&k.downCallBack()),i&&(this.y==this.maxScrollY||i.is(".flip"))&&(k.isLoading=!0,i.addClass("loading"),k.upCallBack&&k.upCallBack()))}}),k.jTop=h,k.jBottom=i,k.isReady=!0},h.prototype.end=function(){this._isLoadMoreEnd=!0,this._refresh(),this.jBottom&&this.jBottom.html("没有更多了...")},h.prototype.hide=function(){this._refresh()},h.prototype._refresh=function(){var a=this;setTimeout(function(){a.isLoading=!1,a._myScroll.refresh()},200)},h.prototype.destroy=function(){this.jTop&&this.jTop.remove(),this.jBottom&&this.jBottom.remove(),this._myScroll.destroy()},h.prototype.bindRender=function(){},h}())}}}])});