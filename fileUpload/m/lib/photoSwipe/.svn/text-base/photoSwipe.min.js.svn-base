define(["jquery","util"],function(a,b){var c=!1;0==a("link[href*=photoSwipe\\.min\\.css]").size()?b.getStyle(GConfig.LIB_ADDRESS+"photoSwipe/photoSwipe.min.css?bust="+GConfig.TAG,function(){c=!0}):c=!0;var d='<div class="photoSwipe-layer"><div class="item-list"><ul class="ks-clear"></ul></div><div class="icon-list"></div></div>',e='<li><img src="{url}" /></li>',f={targetImgs:null,currentIndex:0,closeCallback:null},g=a(window).width(),h=10,i=function(b){var e=this;if(window.wv&&2!=wv.getBridgeListenState()){var g=[];return b.targetImgs.each(function(){g.push(a(this).attr("src"))}),void wv.showPhoto(g,b.currentIndex||0)}if(e.config=a.extend({},f,b||{}),e.nImgCount=b.targetImgs.length,e.showIndex=b.currentIndex||0,e.jLayerContainer=a(d).appendTo(a("body")),e.jItemList=e.jLayerContainer.find(".item-list"),e.jIconList=e.jLayerContainer.find(".icon-list"),e.isAnimating=!1,e.moveLeft=0,!b.targetImgs||0==b.targetImgs.length)return void alert("图片对象为空！");if(c)e._init();else var h=setInterval(function(){c&&(clearInterval(h),clearTimeout(i),e._init())},100),i=setTimeout(function(){throw clearInterval(h),"基础样式文件加载超时，PhotoSwipe 初始化失败"},5e3)};return a.extend(i.prototype,{_init:function(){var c=this;c.config.targetImgs.each(function(d){var f=b.substitute(e,{url:a(this).attr("src")});c.jItemList.find("ul").append(f)}),c.jIconList.html(c.showIndex+1+"/"+c.nImgCount),c._fnResize(),c._fnFlyOpen(),a(window).on("resize orientationchange",function(){c._fnResize()})},destory:function(){this.jLayerContainer.remove()},_fnResize:function(){var b=this,c=a(window).height(),d=c;g=a(window).width();var e=g+2*h;b.jLayerContainer.css({width:g+"px",height:d+"px"}),b.jLayerContainer.find("img").on("load",function(){a(this).css({position:"relative",top:(c-a(this).height())/2+"px"})}),b.showPic(!1,b.showIndex),b.jItemList.width(e*b.nImgCount).height(d).find("li").css({width:e+"px",padding:"0 "+h+"px"}),b.jIconList.css({left:(g-b.jIconList.width())/2+"px",bottom:"30px"})},_getTrueCurrIndex:function(){return this.showIndex},_fnFlyOpen:function(){var b=this,c=a(window).width(),d=a(window).height(),e=a("body").scrollTop(),f=b.config.targetImgs.eq(b.showIndex),g=b.jItemList.find("li:not(.j_tmp) img").eq(b.showIndex),h=f.clone(),i=a('<div class="photoSwiper-tmpContainer"></div>');b.jLayerContainer.css({opacity:0}),i.fadeIn().append(h).appendTo(a("body")).css({height:a(window).height()+"px"}),h.on("load",function(){var a=400,j=f.offset().left,k=f.offset().top-e,l=f.width(),m=f.height(),n=g.width()/l,o=(c-g.width())/2-j,p=(d-g.height())/2-k,q=a+"ms ease",r="translate3D("+o+"px, "+p+"px, 0px) scale("+n+")";h.css({left:j+"px",top:k+"px",width:l+"px",height:m+"px",transformOrigin:"left top",transition:"transform "+q,webkitTransition:"-webkit-transform "+q,transform:r,webkitTransform:r}),b.isAnimating=!0,setTimeout(function(){b.isAnimating=!1,i.remove(),b.jLayerContainer.css({opacity:1}),b._addEventListener()},a)})},_fnFlyClose:function(){var b=this,c=(a(window).width(),a("body").outerHeight(),a("body").scrollTop()),d=b.jItemList.find("li:not(.j_tmp) img").eq(b.showIndex),e=b.config.targetImgs.eq(b.showIndex),f=d.clone(),g=a('<div class="photoSwiper-tmpContainer"></div>');b.isAnimating||f.on("load",function(){g.append(f).appendTo(a("body")).css({height:a(window).height()+"px"});var h=400,i=(parseFloat(d.data("scale")||1),parseFloat(d.data("transX")||0)),j=parseFloat(d.data("transY")||0),k=d.offset().left-i,l=d.offset().top-j-c,m=d.width(),n=d.height(),o=e.width()/m,p=e.offset().left-k,q=e.offset().top-l-c,r=h+"ms ease",s="translate3D("+p+"px, "+q+"px, 0px) scale("+o+")";f.css({transformOrigin:"left top",webkitTransformOrigin:"left top",marginTop:0,left:k+"px",top:l+"px",width:m+"px",height:n+"px",transition:"transform "+r,webkitTransition:"-webkit-transform "+r,transform:s,webkitTransform:s}),setTimeout(function(){g.fadeOut().remove(),b.destory()},h)})},_addEventListener:function(){var a=this;a._fnBindTouch()},_fnBindTouch:function(){function b(){var b,c,e=!1,f=!1,g=0,h=0,i=0,o=0;j.jItemList.find("img").on("touchstart",function(j){var k=a(this),l=d(j),q=k.data("scale")||1,r=k.parent();b=a(window).width(),c=a(window).height(),m=l.x,n=l.y,e=k.width()*q>r.width(),f=k.height()*q>r.height(),g=-(b-k.width()*q)/2,h=(b-k.width()*q)/2,i=-(c-k.height()*q)/2,o=(c-k.height()*q)/2,p=0}).on("touchmove",function(b){var c=a(this),i=c.parent(),j=d(b),k=parseFloat(c.data("scale")||1),l=parseFloat(c.data("transX")||0),o=parseFloat(c.data("transY")||0),q=j.x-m+l,r=j.y-n+o;i.scrollLeft();if(e||(q=0),f||(r=0),1!=k){if(!(q>0&&g>=q||0>q&&q>=h))return void(0==p&&(p=j.x-m));p=0,b.stopPropagation(),c.css({transitionDuration:"0s",transform:"translate3D("+q+"px, "+r+"px, 0px) scale("+k+")"})}}).on("touchend",function(b){var c=a(this),j=c.parent(),q=d(b),r=parseFloat(c.data("scale")||1),s=parseFloat(c.data("transX")||0),t=parseFloat(c.data("transY")||0),u=q.x-m+s,v=q.y-n+t,w=(j.scrollLeft(),10),x=(new Date).getTime()-l;2!=k&&200>x&&Math.abs(q.x-m)<w&&Math.abs(q.x-m)<w&&(k=1),e?u>g?u=g:h>u?u=h:1!=k&&2!=k&&b.stopPropagation():u=0,f?v>i?v=i:o>v?v=o:1!=k&&2!=k&&b.stopPropagation():v=0,1!=r&&c.css({transitionDuration:"0.2s",transform:"translate3D("+u+"px, "+v+"px, 0px) scale("+r+")"}),c.data("transX",u).data("transY",v),p=0})}function c(a){var b,c,d=j.jItemList.find("img").eq(j.showIndex),e=d.parent(),f=!d.data("scale")||"1"==d.data("scale"),g=2,h="50%",i="50%";void 0==d.data("initWidth")&&d.data("initWidth",d.width()).data("initHeight",d.height()),a&&f||(g=1),console.log(g),b=parseFloat(d.data("initWidth")||d.width())*g,c=parseFloat(d.data("initHeight")||d.height())*g;(e.height()-c)/2;d.css({transformOrigin:h+" "+i,transitionDuration:"0.2s",transform:"scale("+g+")"}).data("scale",g).data("transX",0).data("transY",0)}function d(a){var b=a.changedTouches||a.originalEvent.changedTouches,c={x:a.pageX,y:a.pageY};return a.type.indexOf("touch")>-1&&(c.x=b[b.length-1].pageX,c.y=b[b.length-1].pageY),c}function e(a){l=(new Date).getTime(),k=0,i&&300>l-i&&(k=2,clearTimeout(o)),i=l,a.preventDefault();var b=d(a);m=b.x,n=b.y}function f(a){var b=d(a),c=b.x-m-p,e=b.y-n;Math.abs(e)<Math.abs(c)&&a.preventDefault(),j._setTransform(0,j.moveLeft+c)}function h(a){function b(){j.showPic(!0)}var e=d(a),f=e.x-m-p,h=e.y-n,i=10,q=(new Date).getTime()-l;return 2!=k&&200>q&&Math.abs(f)<i&&Math.abs(h)<i&&(k=1),1==k?void(o=setTimeout(function(){j.config.closeCallback&&j.config.closeCallback(j.showIndex),j._fnFlyClose.call(j),b()},300-q)):2==k?(c(a),b()):Math.abs(h)>=Math.abs(f)?b():Math.abs(f)<g/2&&q>200?b():(j.isAnimating||(f>0?j.showIndex>0&&(c(),j.showIndex--):j.showIndex<j.nImgCount-1&&(c(),j.showIndex++)),void b())}var i,j=this,k=0,l=0,m=0,n=0,o=null,p=0;!function(){j.jItemList.on("touchstart",e).on("touchmove",f).on("touchend",h),b()}()},showPic:function(a,b){var c=this,d=400;void 0!=b&&(c.showIndex=b);var e=g+2*h;return c.moveLeft=-c.showIndex*e-h,c._setTransform(a?d:0,c.moveLeft),a&&(c.isAnimating=!0,setTimeout(function(){c.isAnimating=!1},d)),c.jIconList.html(c.showIndex+1+"/"+c.nImgCount),this},_setTransform:function(a,b){var c=this;c.jItemList.css({transitionDuration:a+"ms",webkitTransitionDuration:a+"ms",transform:"translateX("+b+"px)",webkitTransform:"translateX("+b+"px)"})}}),i});