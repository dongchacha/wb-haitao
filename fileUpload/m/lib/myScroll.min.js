define(["util","iscroll"],function(a,b){var c='<div id="pullDown" class="flip loading"><span class="pullDownIcon"></span><span class="pullDownLabel">加载中...</span></div>',d='<div id="pullUp" class="loading"><span class="pullUpIcon"></span><span class="pullUpLabel"></span></div>',e={targetNode:null,upCallBack:null,downCallBack:null};return Fn=function(a){var b=this;a=$.extend({},e,a),"string"==typeof a.targetNode&&(a.targetNode=$(a.targetNode));var f=$(a.targetNode).find(">*").eq(0).is("ul");this.topHtml=c,this.bottomHtml=d,f&&(this.topHtml=this.topHtml.replace(/div/gi,"li"),this.bottomHtml=this.bottomHtml.replace(/div/gi,"li")),b.config=a,b.jScrollTop=null,b.jScrollBottom=null,b._init()},Fn.prototype={_isMoreData:!0,_isLoading:!1,_iScrollModel:null,_init:function(){var a=this,c=a.config.targetNode,d=c.find(">*:first"),e=40;c.get(0).addEventListener("touchmove",function(a){a.preventDefault()},!1),a.jScrollTop=$(a.topHtml).prependTo(d),a._iScrollModel=new b(c.get(0),{useTransition:!0,topOffset:e,vScrollbar:!1,onRefresh:function(){a.jScrollTop.is(".loading")?a.jScrollTop.removeClass("flip").removeClass("loading").find(".pullDownLabel").html("下拉刷新"):a.jScrollBottom&&a.jScrollBottom.removeClass("flip")},onScrollMove:function(){a._isLoading||(this.y>5&&!a.jScrollTop.is(".flip")&&(a.jScrollTop.addClass("flip").find(".pullDownLabel").html("释放刷新"),this.minScrollY=0),a._isMoreData&&a.jScrollBottom&&this.y<0&&!a.jScrollBottom.is(".flip")&&this.y<this.maxScrollY-5&&a.jScrollBottom.addClass("flip"))},onScrollEnd:function(){a._isLoading||(a.jScrollTop.is(".flip")?(a._isLoading=!0,a.jScrollTop.addClass("loading").find(".pullDownLabel").html("加载中..."),a.config.downCallBack()):a._isMoreData&&a.jScrollBottom&&(this.y==this.maxScrollY||a.jScrollBottom.is(".flip"))&&(a._isLoading=!0,a.jScrollBottom.addClass("loading"),a.config.upCallBack()))}})},end:function(a,b){var c=this;c._isMoreData=!1,0===b?c.jScrollBottom&&c.jScrollBottom.remove():(null===c.jScrollBottom&&(c.jScrollBottom=$(c.bottomHtml).appendTo(c.config.targetNode.find(">*:first"))),a>=b?c.jScrollBottom.find(".pullUpIcon").hide().end().find(".pullUpLabel").html("没有更多了.."):(c.jScrollBottom.find(".pullUpIcon").show().end().find(".pullUpLabel").html(""),c._isMoreData=!0)),c._refresh()},_refresh:function(){var a=this;setTimeout(function(){a._isLoading=!1,a._iScrollModel.refresh()},200)},destroy:function(){this.jScrollTop&&this.jScrollTop.remove(),this.jScrollBottom&&this.jScrollBottom.remove(),this._iScrollModel.destroy()}},Fn});